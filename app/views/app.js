define(function(e,t,n){var r=e("backbone");this._=e("underscore"),this.$=e("jquery");var i=13,s=e("/assets/js/app/collections/todos"),o=e("/assets/js/app/views/todo");return AppView=r.View.extend({el:"#todoapp",statsTemplate:_.template($("#stats-template").html()),events:{"keypress #new-todo":"createOnEnter","click #clear-completed":"clearCompleted","click #toggle-all":"toggleAllComplete"},initialize:function(){this.input=this.$("#new-todo"),this.allCheckbox=this.$("#toggle-all")[0],this.$footer=this.$("#footer"),this.$main=this.$("#main"),s.on("add",this.addOne,this),s.on("reset",this.addAll,this),s.on("change:completed",this.filterOne,this),s.on("filter",this.filterAll,this),s.on("all",this.render,this),s.fetch()},render:function(){var e=s.completed().length,t=s.remaining().length;s.length?(this.$main.show(),this.$footer.show(),this.$footer.html(this.statsTemplate({completed:e,remaining:t})),this.$("#filters li a").removeClass("selected").addClass("selected")):(this.$main.hide(),this.$footer.hide()),this.allCheckbox.checked=!t},addOne:function(e){var t=new o({model:e});$("#todo-list").append(t.render().el)},addAll:function(){this.$("#todo-list").html(""),s.each(this.addOne,this)},filterOne:function(e){e.trigger("visible")},filterAll:function(){s.each(this.filterOne,this)},newAttributes:function(){return{title:this.input.val().trim(),order:s.nextOrder(),completed:!1}},createOnEnter:function(e){if(e.which!==i||!this.input.val().trim())return;s.create(this.newAttributes()),this.input.val("")},clearCompleted:function(){return _.each(s.completed(),function(e){e.destroy()}),!1},toggleAllComplete:function(){var e=this.allCheckbox.checked;s.each(function(t){t.save({completed:e})})}}),AppView});